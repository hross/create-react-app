jobs:
 - job: Linux
   pool: 'Hosted VS2017'
     - timeoutInMinutes: 120
   strategy:
     matrix:
       node_8_simple:
          test_suite: simple
          node_version: 8.x
       node_10_simple:
          test_suite: simple
          node_version: 10.x
       node_8_installs:
          test_suite: installs
          node_version: 8.x
       node_10_installs:
          test_suite: installs
          node_version: 10.x
       node_8_kitchensink:
          test_suite: kitchensink
          node_version: 8.x
       node_10_kitchensink:
          test_suite: kitchensink
          node_version: 10.x
       node_8_behavior:
          test_suite: behavior
          node_version: 8.x
       node_10_behavior:
          test_suite: behavior
          node_version: 10.x
       node_8_old_node:
          test_suite: old-node
          node_version: 8.x
       node_10_old_node:
          test_suite: old-node
          node_version: 10.x
       node_8_kitchensink_eject:
          test_suite: kitchensink-eject
          node_version: 8.x
       node_10_kitchensink_eject:
          test_suite: kitchensink-eject
          node_version: 10.x
          
   steps:
    - task: NodeTool@0
      inputs:
        versionSpec: $(node_version)
      displayName: 'Install Node.js'

    - bash: |
        curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --nightly
        export PATH="$HOME/.yarn/bin:$PATH"
        echo Setting up test for: $TEST_SUITE - $NODE_VERSION
      displayName: 'install yarn'
      env: { TEST_SUITE:  $(test_suite), NODE_VERSION: $(node_version) }

    - bash: |
        if [ $TEST_SUITE = "simple" ]; then tasks/e2e-simple.sh; fi
        if [ $TEST_SUITE = "installs" ]; then tasks/e2e-installs.sh; fi   
        if [ $TEST_SUITE = "kitchensink" ]; then tasks/e2e-kitchensink.sh; fi
        if [ $TEST_SUITE = "kitchensink-eject" ]; then tasks/e2e-kitchensink-eject.sh; fi
        if [ $TEST_SUITE = "old-node" ]; then tasks/e2e-old-node.sh; fi
        if [ $TEST_SUITE = "behavior" ]; then tasks/e2e-behavior.sh; fi  
      displayName: 'install and build'
      env: { TEST_SUITE:  $(test_suite), NODE_VERSION: $(node_version) }
